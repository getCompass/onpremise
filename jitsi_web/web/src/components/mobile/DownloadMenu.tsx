import { useCallback, useState } from "react";
import useDeviceDetect from "../../lib/useDeviceDetect.ts";
import { Box, HStack, VStack } from "../../../styled-system/jsx";
import { Property } from "../../../styled-system/types/csstype";
import { Menu, MenuContent, MenuItem, MenuItemGroup, MenuPositioner, MenuTrigger } from "../menu.tsx";
import { Portal } from "@ark-ui/react";
import { Text } from "../text.tsx";
import { useLangString } from "../../lib/getLangString.ts";
import {CLICK_COUNT_AFTER_SHOW_DOWNLOAD_POPOVER} from "../../api/_types.ts";

const AppGalleryIcon = () => {
	return (
		<Box w="22px" h="22px">
			<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
				<path
					d="M3 17.495V4.49949C3.01177 4.47747 3.02115 4.45424 3.02796 4.43021C3.11435 3.95153 3.35224 3.56048 3.7625 3.30549C3.98537 3.16693 4.25247 3.09974 4.49954 3H17.4954C17.5084 3.00793 17.5205 3.02128 17.5343 3.02337C18.2688 3.11519 19.0025 3.79294 18.9996 4.82668C18.9883 8.93913 18.9954 13.0516 18.9929 17.164C18.996 17.3302 18.9799 17.4961 18.9449 17.6586C18.7517 18.4761 18.0685 18.994 17.1958 18.994C13.5832 18.994 9.97046 18.994 6.35759 18.994C5.795 18.994 5.23074 19.0099 4.67107 18.9882C3.9983 18.9631 3.49498 18.6355 3.18781 18.0346C3.10142 17.8668 3.0626 17.6757 3 17.495ZM10.6642 11.5345L10.7222 11.5124C10.746 11.2295 10.774 10.9469 10.7928 10.6636C10.8717 9.46247 10.8925 8.26304 10.683 7.07112C10.6091 6.65087 10.5052 6.23895 10.3137 5.85292C10.2694 5.76361 10.2139 5.73147 10.1171 5.75609C9.95599 5.79783 9.79114 5.82412 9.63254 5.87295C9.35377 5.96284 9.10936 6.13624 8.93244 6.36967C8.75551 6.6031 8.65462 6.88528 8.64342 7.17796C8.64259 7.20406 8.64221 7.23006 8.64227 7.25598C8.6432 7.64491 8.74317 8.01655 8.88716 8.37572C9.33122 9.4825 9.96684 10.4812 10.6271 11.4665C10.6413 11.4882 10.6521 11.5124 10.6642 11.5345ZM11.2752 11.5149L11.3195 11.5191C11.3493 11.4841 11.3772 11.4474 11.4029 11.4093C11.8074 10.7495 12.2247 10.0972 12.6099 9.42616C12.9096 8.90365 13.1633 8.35485 13.294 7.76015C13.4267 7.15459 13.3511 6.60162 12.8658 6.15882C12.6041 5.92094 12.2815 5.84123 11.9476 5.76736C11.8326 5.74205 11.7626 5.75806 11.7096 5.81539C11.6839 5.84312 11.6622 5.88054 11.6413 5.92762C11.4534 6.34955 11.3491 6.79318 11.2802 7.24599C11.0833 8.52972 11.1292 9.8172 11.2339 11.1047C11.2349 11.1194 11.2359 11.1341 11.237 11.1488C11.2373 11.1522 11.2376 11.1556 11.2379 11.159C11.2475 11.2784 11.2629 11.3969 11.2752 11.5153V11.5149ZM10.312 11.7866C10.1591 11.4567 9.99866 11.1306 9.83085 10.8085C9.15084 9.50313 8.34968 8.26366 7.4375 7.10655C7.436 7.10466 7.43451 7.10276 7.43301 7.10086C7.43276 7.10055 7.43252 7.10023 7.43227 7.09992C7.11383 7.42377 6.86175 7.75723 6.709 8.15829C6.4853 8.74506 6.59131 9.27091 7.01283 9.73248C7.02198 9.7423 7.03121 9.75205 7.04052 9.76172C7.12492 9.84947 7.21553 9.93105 7.31166 10.0058C7.34698 10.0341 7.38248 10.062 7.41814 10.0897C8.13228 10.6439 8.91305 11.0863 9.70843 11.5045C9.87104 11.59 10.0343 11.6744 10.1976 11.7587C10.2349 11.7712 10.2732 11.7807 10.312 11.787V11.7866ZM14.561 7.09449C13.4196 8.56102 12.4572 10.096 11.7151 11.7687L11.7153 11.7687C11.776 11.7625 11.8346 11.7436 11.8875 11.7132C12.0088 11.6474 12.1305 11.5822 12.2522 11.517C12.5655 11.3492 12.8789 11.1813 13.1867 11.0037C13.7856 10.6581 14.3749 10.2942 14.8862 9.82305C15.1453 9.58349 15.3294 9.2972 15.3745 8.94163C15.3807 8.89219 15.3848 8.8437 15.3868 8.7961C15.3869 8.79477 15.3869 8.79343 15.387 8.7921C15.4147 8.10316 15.0143 7.59992 14.561 7.09449ZM10.0244 12.1501L10.0395 12.1063C8.7223 11.2416 7.34421 10.4787 5.95777 9.7233C5.56045 10.8668 6.43146 12.1313 7.6159 12.1551C8.15405 12.1658 8.69219 12.1647 9.23033 12.1636C9.45135 12.1631 9.67237 12.1627 9.89339 12.1631C9.93721 12.1631 9.98062 12.1543 10.0244 12.1501ZM16.0343 9.72288C16.0338 9.72314 16.0334 9.7234 16.0329 9.72365C14.6423 10.4867 13.2672 11.2444 11.9639 12.128C12.0007 12.1496 12.0423 12.1616 12.0849 12.1629C12.0856 12.163 12.0863 12.163 12.087 12.163C12.0898 12.163 12.0926 12.1631 12.0953 12.1631C12.1204 12.1631 12.1455 12.1631 12.1706 12.1631C12.3226 12.1631 12.4747 12.1634 12.6268 12.1636C12.9306 12.1642 13.2345 12.1647 13.5383 12.1637C13.5522 12.1636 13.566 12.1636 13.5799 12.1635C13.7148 12.163 13.8497 12.1622 13.9847 12.161C14.2126 12.161 14.4438 12.161 14.6675 12.1159C15.731 11.9019 16.3979 10.7455 16.0329 9.72365C16.0328 9.72339 16.0327 9.72314 16.0326 9.72288H16.0343ZM6.7979 12.5107C6.97736 12.8329 7.18812 13.0904 7.47693 13.2769C7.70634 13.4248 7.9443 13.5001 8.18506 13.4749C8.18831 13.4746 8.19155 13.4742 8.1948 13.4738C8.32313 13.459 8.45223 13.4155 8.58124 13.3391C8.92242 13.1363 9.25877 12.9233 9.5949 12.7104C9.71106 12.6369 9.82718 12.5633 9.94347 12.4902C9.96142 12.4786 9.97018 12.4523 10.0061 12.3993L6.7979 12.5107ZM11.9731 12.3989C11.9917 12.4219 12.0045 12.4391 12.0142 12.452C12.0292 12.4721 12.0366 12.4821 12.0465 12.4882C12.1576 12.5571 12.2686 12.6262 12.3796 12.6953C12.7437 12.922 13.108 13.1488 13.4755 13.3704C13.6437 13.469 13.8423 13.5025 14.0335 13.4643C14.5886 13.3658 14.91 12.981 15.2021 12.5107L11.9731 12.3989ZM11.2293 14.4885C11.2346 14.508 11.239 14.5256 11.2431 14.5419C11.2506 14.5719 11.257 14.5974 11.2656 14.622C11.3189 14.7756 11.3727 14.9291 11.4264 15.0826C11.5444 15.4195 11.6624 15.7565 11.7756 16.0948C11.7939 16.1496 11.8172 16.1812 11.8504 16.1981C11.8778 16.212 11.9119 16.2159 11.9555 16.2146C12.0519 16.2116 12.1183 16.2091 12.1533 16.0956C12.2406 15.8127 12.3428 15.5343 12.4396 15.2547C12.4551 15.2105 12.4755 15.1683 12.5068 15.0928C12.632 15.4517 12.7456 15.7693 12.8482 16.0906C12.8829 16.1987 12.9442 16.2137 13.0427 16.2158C13.0712 16.2164 13.0962 16.2146 13.1182 16.2093C13.1417 16.2035 13.1618 16.1935 13.179 16.1779C13.1804 16.1766 13.1818 16.1753 13.1831 16.1739C13.2033 16.1539 13.2195 16.1256 13.2326 16.086C13.3971 15.5931 13.5723 15.104 13.7426 14.6132C13.7544 14.572 13.764 14.5302 13.7714 14.488C13.771 14.4881 13.7706 14.4881 13.7701 14.4881C13.7427 14.4904 13.7151 14.4911 13.6876 14.4903C13.6871 14.4903 13.6866 14.4902 13.6861 14.4902C13.6737 14.4898 13.6614 14.4891 13.6491 14.488C13.6305 14.4845 13.613 14.4821 13.5965 14.481C13.4568 14.4713 13.3897 14.5478 13.3486 14.7009C13.2901 14.9208 13.2179 15.1372 13.1413 15.3668C13.1086 15.4649 13.0751 15.5654 13.0415 15.6695C13.0413 15.6689 13.041 15.6682 13.0408 15.6676C12.9196 15.3015 12.8076 14.9736 12.7038 14.6433C12.6721 14.5417 12.6369 14.4849 12.519 14.4808C12.5144 14.4806 12.5096 14.4805 12.5048 14.4805C12.3754 14.4805 12.3378 14.5415 12.3082 14.6475C12.2724 14.7705 12.231 14.8918 12.1895 15.0132C12.1704 15.0688 12.1514 15.1245 12.1329 15.1804C12.1001 15.2786 12.0676 15.3771 12.0352 15.4757C12.0189 15.525 12.0027 15.5743 11.9864 15.6236C11.9862 15.623 11.9859 15.6225 11.9857 15.6219C11.8511 15.292 11.7334 14.9555 11.6329 14.6137C11.6112 14.5408 11.5802 14.5032 11.5276 14.4914C11.5075 14.4868 11.4843 14.486 11.4572 14.4885C11.4096 14.4917 11.3621 14.4907 11.3113 14.4896C11.3111 14.4896 11.3109 14.4896 11.3107 14.4896C11.2842 14.489 11.2568 14.4885 11.2281 14.4885H11.2293ZM5.88724 14.4947V16.2012H6.23029H6.23113V15.5197V15.5189H7.0241V16.1991H7.36132V14.4976H7.01784V15.1741H6.22487V15.1733V14.4947H5.88724ZM15.3319 14.488H14.0798V14.4893V16.1991H15.3636H15.3657V15.8953H14.4225V15.4625V15.4613H15.0444H15.0464V15.1478H14.4242V14.7981H15.3302L15.3302 14.7954L15.3319 14.488ZM7.86965 14.4951C7.86965 14.6015 7.86815 14.7065 7.86648 14.8105C7.86624 14.8254 7.866 14.8403 7.86576 14.8551C7.86143 15.1195 7.85721 15.3776 7.87508 15.634C7.90095 16.0055 8.16723 16.2212 8.56329 16.2379C8.57742 16.2385 8.59144 16.2389 8.60533 16.2389C8.61527 16.2389 8.62514 16.2388 8.63494 16.2385C8.99582 16.2295 9.26806 16.0324 9.31077 15.6841C9.3525 15.3302 9.33539 14.9688 9.3429 14.6107C9.3415 14.5717 9.33774 14.5328 9.33164 14.4943H8.99525C8.99525 14.6675 8.99525 14.8328 8.99525 14.9976C8.99454 15.0455 8.99452 15.0934 8.99456 15.1414C8.99456 15.1457 8.99456 15.15 8.99457 15.1543C8.99468 15.2965 8.9948 15.4387 8.97851 15.5789C8.97812 15.5822 8.97771 15.5856 8.9773 15.589C8.95132 15.8005 8.81276 15.9026 8.60082 15.9019C8.59694 15.9019 8.59303 15.9018 8.5891 15.9018C8.58705 15.9017 8.58498 15.9016 8.58291 15.9016C8.37006 15.8949 8.22941 15.7722 8.21814 15.5539C8.20437 15.2948 8.21021 15.0343 8.20813 14.7743C8.20813 14.6829 8.20813 14.5915 8.20813 14.4951H7.86965ZM11.3366 16.2062C11.3216 16.1645 11.3124 16.1298 11.2982 16.0977C11.0799 15.5969 10.8558 15.1015 10.645 14.5991C10.6117 14.5194 10.5662 14.4975 10.5104 14.4897C10.4916 14.4871 10.4717 14.4861 10.4507 14.485C10.4418 14.4845 10.4327 14.4841 10.4234 14.4834C10.3203 14.4772 10.2652 14.5106 10.2231 14.6087C10.0755 14.9524 9.92429 15.2948 9.77309 15.6372C9.70624 15.7886 9.6394 15.94 9.57286 16.0914C9.55888 16.1284 9.54696 16.166 9.53716 16.2042C9.53709 16.2045 9.53703 16.2047 9.53697 16.205C9.86209 16.2267 9.85833 16.2246 9.99856 15.9487C10.0142 15.9231 10.0353 15.9013 10.0603 15.8847C10.0854 15.8681 10.1137 15.8572 10.1434 15.8527C10.3195 15.8406 10.4973 15.8557 10.6734 15.8452C10.7198 15.8425 10.7585 15.8467 10.79 15.8598C10.8394 15.8803 10.871 15.9224 10.8863 15.993C10.9016 16.0644 10.9278 16.1192 10.965 16.1572C10.9654 16.1576 10.9659 16.1581 10.9663 16.1585C11.0243 16.2167 11.1086 16.235 11.2201 16.2133C11.2582 16.2084 11.2965 16.2059 11.3349 16.2058L11.3366 16.2062ZM15.8022 14.4951V16.2H16.1232V14.4951H15.8022Z"
					fill="#DCDCDC"
				/>
				<path
					d="M10.688 15.5284H10.1705C10.2296 15.3871 10.2871 15.2524 10.3488 15.108C10.3744 15.0482 10.4007 14.9867 10.428 14.9225C10.5211 15.1395 10.6017 15.3264 10.688 15.5284Z"
					fill="#DCDCDC"
				/>
				<path
					fillRule="evenodd"
					clipRule="evenodd"
					d="M8.88716 8.37572C8.74313 8.01646 8.64315 7.6462 8.64227 7.25598C8.6432 7.64491 8.74317 8.01655 8.88716 8.37572Z"
					fill="#DCDCDC"
				/>
				<path
					fillRule="evenodd"
					clipRule="evenodd"
					d="M11.2752 11.5153L11.3191 11.5195C11.3192 11.5194 11.3194 11.5193 11.3195 11.5191L11.2752 11.5149V11.5153ZM11.2335 11.1051C11.2346 11.1197 11.2358 11.1343 11.237 11.1488C11.2359 11.1341 11.2349 11.1194 11.2339 11.1047C11.1292 9.8172 11.0833 8.52972 11.2802 7.24599C11.3491 6.79318 11.4534 6.34955 11.6413 5.92762C11.6622 5.88054 11.6839 5.84312 11.7096 5.81539C11.6837 5.84317 11.6619 5.88073 11.6408 5.92807C11.453 6.34999 11.3491 6.79362 11.2798 7.24643C11.0828 8.53016 11.1288 9.81765 11.2335 11.1051Z"
					fill="#DCDCDC"
				/>
				<path
					fillRule="evenodd"
					clipRule="evenodd"
					d="M11.7153 11.7687L11.7151 11.7691C11.7758 11.7629 11.8346 11.744 11.8875 11.7136C12.0141 11.6448 12.1411 11.5767 12.2682 11.5086C12.5761 11.3435 12.8841 11.1784 13.1867 11.0041C13.7856 10.6581 14.3749 10.2963 14.8861 9.82344C15.1453 9.58388 15.3294 9.29759 15.3744 8.94202C15.3807 8.89244 15.3848 8.84382 15.3868 8.7961C15.3848 8.8437 15.3807 8.89219 15.3745 8.94163C15.3294 9.2972 15.1453 9.58349 14.8862 9.82305C14.3749 10.2942 13.7856 10.6581 13.1867 11.0037C12.8789 11.1813 12.5655 11.3492 12.2522 11.517C12.1305 11.5822 12.0088 11.6474 11.8875 11.7132C11.8346 11.7436 11.776 11.7625 11.7153 11.7687Z"
					fill="#DCDCDC"
				/>
				<path
					fillRule="evenodd"
					clipRule="evenodd"
					d="M16.0329 9.72365C16.0328 9.72339 16.0327 9.72314 16.0326 9.72288C14.6416 10.4862 13.266 11.2424 11.9622 12.128C11.9995 12.1498 12.0417 12.1619 12.0849 12.1629C12.0423 12.1616 12.0007 12.1496 11.9639 12.128C13.2672 11.2444 14.6423 10.4867 16.0329 9.72365ZM13.5799 12.1635C13.566 12.1636 13.5522 12.1636 13.5383 12.1637C13.2345 12.1647 12.9306 12.1642 12.6268 12.1636C12.4747 12.1634 12.3226 12.1631 12.1706 12.1631C12.2969 12.1632 12.4233 12.1634 12.5496 12.1637C12.893 12.1643 13.2365 12.1649 13.5799 12.1635Z"
					fill="#DCDCDC"
				/>
				<path
					fillRule="evenodd"
					clipRule="evenodd"
					d="M11.9731 12.3989L11.9718 12.3988C11.9908 12.4223 12.0037 12.4397 12.0134 12.4527C12.0281 12.4724 12.0355 12.4823 12.0452 12.4886C12.1563 12.5575 12.2673 12.6266 12.3783 12.6957C12.7424 12.9224 13.1067 13.1492 13.4743 13.3708C13.6429 13.4696 13.8419 13.5029 14.0335 13.4643C13.8423 13.5025 13.6437 13.469 13.4755 13.3704C13.108 13.1488 12.7437 12.922 12.3796 12.6953C12.2686 12.6262 12.1576 12.5571 12.0465 12.4882C12.0366 12.4821 12.0292 12.4721 12.0142 12.452C12.0045 12.4391 11.9917 12.4219 11.9731 12.3989Z"
					fill="#DCDCDC"
				/>
				<path
					fillRule="evenodd"
					clipRule="evenodd"
					d="M9.58795 12.715C9.70638 12.6399 9.8248 12.5648 9.94347 12.4902C9.82718 12.5633 9.71106 12.6369 9.5949 12.7104C9.25877 12.9233 8.92242 13.1363 8.58124 13.3391C8.92093 13.1377 9.25449 12.9263 9.58795 12.715ZM8.1948 13.4738C8.19155 13.4742 8.18831 13.4746 8.18506 13.4749C7.9443 13.5001 7.70634 13.4248 7.47693 13.2769C7.70863 13.4273 7.95005 13.5025 8.1948 13.4738Z"
					fill="#DCDCDC"
				/>
				<path
					fillRule="evenodd"
					clipRule="evenodd"
					d="M9.34028 12.1639C9.52465 12.1635 9.70902 12.1631 9.89339 12.1631C9.67237 12.1627 9.45135 12.1631 9.23033 12.1636C8.69219 12.1647 8.15405 12.1658 7.6159 12.1551C8.1907 12.1665 8.76549 12.1652 9.34028 12.1639Z"
					fill="#DCDCDC"
				/>
				<path
					fillRule="evenodd"
					clipRule="evenodd"
					d="M6.22403 14.4947H5.88556V16.202H6.23029V16.2012H5.88724V14.4947L6.22403 14.4947ZM6.22487 15.1733V15.1741H7.01784V14.4976H7.36132L7.017 14.4976V15.1733H6.22487ZM7.36132 16.1991H7.0241V15.5189H6.23113V15.5197H7.02326V16.1999H7.36131L7.36132 16.1991Z"
					fill="#DCDCDC"
				/>
				<path
					fillRule="evenodd"
					clipRule="evenodd"
					d="M10.5104 14.4897C10.4899 14.4865 10.4682 14.4853 10.4453 14.484C10.4375 14.4836 10.4295 14.4831 10.4214 14.4826C10.3183 14.4767 10.2628 14.5101 10.221 14.6078C10.0734 14.9516 9.92224 15.294 9.77104 15.6363C9.70419 15.7877 9.63734 15.9391 9.5708 16.0906C9.55673 16.1277 9.54474 16.1656 9.53491 16.2041C9.53566 16.2041 9.53641 16.2042 9.53716 16.2042C9.54696 16.166 9.55888 16.1284 9.57286 16.0914C9.6394 15.94 9.70624 15.7886 9.77309 15.6372C9.92429 15.2948 10.0755 14.9524 10.2231 14.6087C10.2652 14.5106 10.3203 14.4772 10.4234 14.4834C10.4327 14.4841 10.4418 14.4845 10.4507 14.485C10.4717 14.4861 10.4916 14.4871 10.5104 14.4897ZM10.8842 15.9921C10.9006 16.0641 10.9274 16.1191 10.965 16.1572C10.9278 16.1192 10.9016 16.0644 10.8863 15.993C10.871 15.9224 10.8394 15.8803 10.79 15.8598C10.8382 15.8806 10.8691 15.9225 10.8842 15.9921ZM10.1705 15.5284C10.2296 15.3871 10.2871 15.2524 10.3488 15.108C10.3744 15.0482 10.4007 14.9867 10.428 14.9225C10.3346 15.142 10.2553 15.3285 10.1705 15.5284Z"
					fill="#DCDCDC"
				/>
				<path
					fillRule="evenodd"
					clipRule="evenodd"
					d="M15.3302 14.7994V14.7954L15.3302 14.7981H14.4242V15.1478L14.4242 14.7994H15.3302ZM15.0444 15.4613H14.4225V15.4625H15.0444V15.4613ZM15.3636 16.1991V16.2004H14.0778V14.4893H14.0798V16.1991H15.3636Z"
					fill="#DCDCDC"
				/>
				<path
					fillRule="evenodd"
					clipRule="evenodd"
					d="M15.8022 14.4951L15.8014 14.4952V16.2H16.1223L15.8022 16.2V14.4951Z"
					fill="#DCDCDC"
				/>
				<path
					fillRule="evenodd"
					clipRule="evenodd"
					d="M10.312 11.787C10.2736 11.7811 10.2358 11.772 10.1989 11.7599C10.0351 11.6753 9.87148 11.5904 9.70843 11.5045C9.87104 11.59 10.0343 11.6744 10.1976 11.7587C10.2349 11.7712 10.2732 11.7807 10.312 11.787ZM7.41814 10.0897C7.38248 10.062 7.34698 10.0341 7.31166 10.0058C7.21553 9.93105 7.12492 9.84947 7.04052 9.76172C7.12527 9.84996 7.2163 9.93197 7.31288 10.0071C7.3478 10.0349 7.38289 10.0625 7.41814 10.0897ZM7.43301 7.10086C7.43451 7.10276 7.436 7.10466 7.4375 7.10655L7.4335 7.10036L7.43301 7.10086Z"
					fill="#DCDCDC"
				/>
				<path
					fillRule="evenodd"
					clipRule="evenodd"
					d="M7.86648 14.8105C7.86815 14.7065 7.86965 14.6015 7.86965 14.4951L8.20606 14.4951H7.86801C7.86801 14.6179 7.86593 14.7384 7.86387 14.8576C7.85935 15.1198 7.85494 15.3755 7.87301 15.634C7.89931 16.0101 8.16182 16.2212 8.56123 16.2379C8.57607 16.2386 8.59077 16.2389 8.60533 16.2389C8.59144 16.2389 8.57742 16.2385 8.56329 16.2379C8.16723 16.2212 7.90095 16.0055 7.87508 15.634C7.85721 15.3776 7.86143 15.1195 7.86576 14.8551C7.866 14.8403 7.86624 14.8254 7.86648 14.8105ZM8.5891 15.9018C8.59303 15.9018 8.59694 15.9019 8.60082 15.9019C8.81276 15.9026 8.95132 15.8005 8.9773 15.589C8.97771 15.5856 8.97812 15.5822 8.97851 15.5789L8.97524 15.589C8.99274 15.4456 8.99262 15.2999 8.9925 15.1543C8.9925 15.1513 8.9925 15.1483 8.99249 15.1454L8.99456 15.1414C8.99452 15.0934 8.99454 15.0455 8.99525 14.9976V14.4943L9.32957 14.4943H8.99319C8.99319 14.5526 8.99347 14.6099 8.99375 14.6665C8.9943 14.7779 8.99485 14.8869 8.99319 14.9976C8.99246 15.0468 8.99246 15.0961 8.99249 15.1454L8.60938 15.8853L8.5891 15.9018ZM8.60938 15.8853L8.60082 15.9019C8.81159 15.902 8.94934 15.7998 8.97524 15.589L8.60938 15.8853Z"
					fill="#DCDCDC"
				/>
			</svg>
		</Box>
	);
};

const GooglePlayIcon = () => {
	return (
		<Box w="22px" h="22px">
			<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
				<path
					d="M11.7361 11.0268L4.41048 18.4277C4.16781 18.1643 4.03903 17.8425 4.00427 17.4781C3.99824 17.4132 4.00036 17.3473 4.00036 17.2817C4.00036 13.096 4.00036 8.91028 4.00036 4.72457C4.00036 4.28918 4.12099 3.90539 4.38422 3.59722L11.7361 11.0268Z"
					fill="#DCDCDC"
				/>
				<path
					d="M12.3555 11.6091L14.9233 14.2046L13.1158 15.1825C10.9025 16.3794 8.68921 17.5765 6.47593 18.7739C6.0676 18.9953 5.64507 19.0656 5.19558 18.9333C5.1786 18.9291 5.16199 18.9234 5.14591 18.9165C5.13562 18.9115 5.12853 18.9007 5.13349 18.9057L12.3555 11.6091Z"
					fill="#DCDCDC"
				/>
				<path
					d="M14.9283 7.80097L12.3644 10.3918L5.13278 3.08621C5.58405 2.93643 6.02857 2.98301 6.46068 3.21665C8.1068 4.10822 9.75352 4.99858 11.4008 5.88776C12.502 6.48333 13.6033 7.07854 14.7048 7.6734C14.7818 7.71532 14.857 7.76047 14.9283 7.80097Z"
					fill="#DCDCDC"
				/>
				<path
					d="M12.9338 11.0153C13.8562 10.0836 14.7722 9.15766 15.7034 8.21665L16.7046 8.75703C17.1619 9.00357 17.6181 9.25155 18.0758 9.49737C18.6753 9.81988 19.0046 10.3216 19 11.0082C18.9953 11.6947 18.6611 12.1889 18.058 12.5086C17.302 12.9095 16.5513 13.3209 15.8003 13.7305C15.7198 13.7746 15.6658 13.7918 15.5874 13.7126C14.7154 12.8246 13.8403 11.9391 12.9622 11.0562C12.9516 11.0434 12.9421 11.0297 12.9338 11.0153Z"
					fill="#DCDCDC"
				/>
			</svg>
		</Box>
	);
};

const AppStoreIcon = () => {
	return (
		<Box w="22px" h="22px">
			<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
				<path
					d="M4.71428 3H17.2857C18.2321 3 19 3.76786 19 4.71429V17.2857C19 18.2321 18.2321 19 17.2857 19H4.71428C3.76786 19 3 18.2321 3 17.2857V4.71429C3 3.76786 3.76786 3 4.71428 3ZM14.4643 15.5893C14.6607 15.9321 15.1 16.0464 15.4393 15.85C15.7821 15.6536 15.8964 15.2143 15.7 14.875L15.1893 13.9929C14.6143 13.8179 14.1429 13.9536 13.775 14.4L14.4643 15.5893ZM9.50357 13.6643H16C16.3929 13.6643 16.7143 13.3429 16.7143 12.95C16.7143 12.5571 16.3929 12.2357 16 12.2357H14.1786L11.8429 8.19286L12.575 6.92857C12.7714 6.58571 12.6536 6.15 12.3143 5.95357C11.9714 5.75714 11.5357 5.875 11.3393 6.21429L11.0214 6.76429L10.7036 6.21429C10.5071 5.87143 10.0679 5.75714 9.72857 5.95357C9.38571 6.15 9.27143 6.58929 9.46786 6.92857L12.5321 12.2357H10.3143C9.59286 12.2357 9.18929 13.0821 9.50357 13.6643ZM6 13.6643H7.03571L6.33571 14.875C6.13929 15.2179 6.25714 15.6536 6.59643 15.85C6.93929 16.0464 7.375 15.9286 7.57143 15.5893C8.74643 13.5571 9.625 12.0286 10.2143 11.0143C10.8107 9.97857 10.3857 8.94286 9.96071 8.59286C9.49286 9.40357 8.79286 10.6179 7.85714 12.2357H6C5.60714 12.2357 5.28571 12.5571 5.28571 12.95C5.28571 13.3464 5.60714 13.6643 6 13.6643Z"
					fill="#DCDCDC"
				/>
			</svg>
		</Box>
	);
};

type DownloadMenuProps = {
	triggerEl: JSX.Element;
	width: Property.Width | undefined;
	marginTop: Property.MarginTop;
	isNeedDeviceAutoDetect: boolean;
	clickCount: number;
};

const DownloadMenu = ({ triggerEl, width, marginTop, isNeedDeviceAutoDetect, clickCount }: DownloadMenuProps) => {
	const langStringPageMobileDownloadCompassStoresAppStore = useLangString("mobile.download_compass.stores.appstore");

	const langStringPageMobileDownloadCompassStoresGooglePlay = useLangString(
		"mobile.download_compass.stores.google_play"
	);

	const langStringPageMobileDownloadCompassStoresAppGallery = useLangString(
		"mobile.download_compass.stores.app_gallery"
	);

	const deviceDetect = useDeviceDetect();

	const [isStoreMenuOpen, setStoreMenuOpen] = useState(false);

	const onClickHandler = useCallback(() => {
		if (isNeedDeviceAutoDetect) {
			if (deviceDetect.isMobileAndroid) {
				window.location.href = "https://play.google.com/store/apps/details?id=com.getcompass.android.enterprise";
				return;
			}

			if (deviceDetect.isMobileApple) {
				window.location.href = "https://apps.apple.com/ru/app/compass-on-premise/id6469516890";
				return;
			}

			if (deviceDetect.isMobileHuawei) {
				window.location.href = "https://appgallery.huawei.com/app/C109414583";
				return;
			}
		}
	}, [deviceDetect, isNeedDeviceAutoDetect]);

	const onSelectHandler = useCallback((value: string) => {
		switch (value) {
			case "app_store":
				window.location.href = "https://apps.apple.com/ru/app/compass-on-premise/id6469516890";
				break;

			case "google_play":
				window.location.href = "https://play.google.com/store/apps/details?id=com.getcompass.android.enterprise";
				break;

			case "app_gallery":
				window.location.href = "https://appgallery.huawei.com/app/C109414583";
				break;

			default:
				break;
		}

		setTimeout(() => setStoreMenuOpen(false), 500);
	}, []);

	return (
		<Menu
			isOpen={isStoreMenuOpen}
			onSelect={({ value }) => onSelectHandler(value)}
			onClose={() => setStoreMenuOpen(false)}
			onFocusOutside={() => setStoreMenuOpen(false)}
			onInteractOutside={() => setStoreMenuOpen(false)}
			onPointerDownOutside={() => setStoreMenuOpen(false)}
			positioning={{ placement: "top", offset: { mainAxis: 12 } }}
			type="mobile"
		>
			<VStack w="100%" gap="0px">
				{clickCount >= CLICK_COUNT_AFTER_SHOW_DOWNLOAD_POPOVER ? (
					<MenuTrigger asChild>
						<Box w={width} mt={marginTop} onClick={() => onClickHandler()}>
							{triggerEl}
						</Box>
					</MenuTrigger>
				) : (
					<Box w={width} mt={marginTop} onClick={() => onClickHandler()}>
						{triggerEl}
					</Box>
				)}
			</VStack>
			<Portal>
				<MenuPositioner w="290px">
					<MenuContent>
						<MenuItemGroup id="stores">
							<MenuItem id="app_store">
								<HStack gap="8px">
									<AppStoreIcon />
									<Text style="inter_18_27_400" color="333e49">
										{langStringPageMobileDownloadCompassStoresAppStore}
									</Text>
								</HStack>
							</MenuItem>
							<MenuItem id="google_play">
								<HStack gap="8px">
									<GooglePlayIcon />
									<Text style="inter_18_27_400" color="333e49">
										{langStringPageMobileDownloadCompassStoresGooglePlay}
									</Text>
								</HStack>
							</MenuItem>
							<MenuItem id="app_gallery">
								<HStack gap="8px">
									<AppGalleryIcon />
									<Text style="inter_18_27_400" color="333e49">
										{langStringPageMobileDownloadCompassStoresAppGallery}
									</Text>
								</HStack>
							</MenuItem>
						</MenuItemGroup>
					</MenuContent>
				</MenuPositioner>
			</Portal>
		</Menu>
	);
};

export default DownloadMenu;
